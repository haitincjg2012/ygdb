var ZYFILE={fileInput:null,uploadInput:null,dragDrop:null,url:"",uploadFile:[],lastUploadFile:[],perUploadFile:[],fileNum:0,filterFile:function(e){return e},onSelect:function(){},onDelete:function(){},onProgress:function(){},onSuccess:function(){},onFailure:function(){},onComplete:function(){},funDragHover:function(e){return e.stopPropagation(),e.preventDefault(),this["dragover"===e.type?"onDragOver":"onDragLeave"].call(e.target),this},funGetFiles:function(e){var n=this;this.funDragHover(e);var i=e.target.files||e.dataTransfer.files;n.lastUploadFile=this.uploadFile,this.uploadFile=this.uploadFile.concat(this.filterFile(i));var t=[],l=[],o=[];return $.each(n.lastUploadFile,function(e,n){l.push(n.name)}),$.each(n.uploadFile,function(e,n){o.push(n.name)}),$.each(o,function(e,i){$.inArray(i,l)<0&&t.push(n.uploadFile[e])}),this.uploadFile=t,this.funDealtFiles(),!0},funDealtFiles:function(){var e=this;$.each(this.uploadFile,function(n,i){i.index=e.fileNum,e.fileNum++});var n=this.uploadFile;return this.perUploadFile=this.perUploadFile.concat(this.uploadFile),this.uploadFile=this.lastUploadFile.concat(this.uploadFile),this.onSelect(n,this.uploadFile),console.info("继续选择"),console.info(this.uploadFile),this},funDeleteFile:function(e,n){var i=this,t=[],l=this.perUploadFile[e];return console.info(l),$.each(this.uploadFile,function(e,n){l!=n&&t.push(n)}),this.uploadFile=t,n&&i.onDelete(l,this.uploadFile),console.info("还剩这些文件没有上传:"),console.info(this.uploadFile),!0},funUploadFiles:function(){var e=this;$.each(this.uploadFile,function(n,i){e.funUploadFile(i)})},funUploadFile:function(e){var n=this,i=new FormData;i.append("fileList",e);var t=new XMLHttpRequest;t.upload.addEventListener("progress",function(i){n.onProgress(e,i.loaded,i.total)},!1),t.addEventListener("load",function(){n.funDeleteFile(e.index,!1),n.onSuccess(e,t.responseText),0==n.uploadFile.length&&n.onComplete("全部完成")},!1),t.addEventListener("error",function(){n.onFailure(e,t.responseText)},!1),t.open("POST",n.url,!0),t.setRequestHeader("X_FILENAME",e.name),t.send(i)},funReturnNeedFiles:function(){return this.uploadFile},init:function(){var e=this;this.dragDrop&&(this.dragDrop.addEventListener("dragover",function(n){e.funDragHover(n)},!1),this.dragDrop.addEventListener("dragleave",function(n){e.funDragHover(n)},!1),this.dragDrop.addEventListener("drop",function(n){e.funGetFiles(n)},!1)),e.fileInput&&this.fileInput.addEventListener("change",function(n){e.funGetFiles(n)},!1),e.uploadInput&&this.uploadInput.addEventListener("click",function(n){e.funUploadFiles(n)},!1)}};