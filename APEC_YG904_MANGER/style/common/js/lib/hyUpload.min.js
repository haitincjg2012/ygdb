!function(i){i.fn.hyUpload=function(e){var t=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var d=this[0][e];if(i.isFunction(d))return d.apply(this,t);throw"hyUpload - No such method: "+e}return this.each(function(){var t={},d=this,a={width:"700px",height:"400px",itemWidth:"140px",itemHeight:"120px",url:"/upload/UploadAction",multiple:!0,dragDrop:!0,del:!0,finishDel:!1,onSelect:function(){},onDelete:function(){},onSuccess:function(){},onFailure:function(){},onComplete:function(){}};t=i.extend(a,e),this.init=function(){this.createHtml(),this.createCorePlug()},this.createHtml=function(){var e="";e=t.multiple?"multiple":"";var a="";if(t.dragDrop)a+='<form id="uploadForm" action="'+t.url+'" method="post" enctype="multipart/form-data">',a+='   <div class="upload_box">',a+='       <div class="upload_main">',a+='           <div class="upload_choose">',a+='               <div class="convent_choice">',a+='                   <div class="andArea">',a+='                       <div class="filePicker">点击选择文件</div>',a+='                       <input id="fileImage" type="file" size="30" name="fileselect[]" '+e+">",a+="                   </div>",a+="               </div>",a+='               <span id="fileDragArea" class="upload_drag_area">或者将文件拖到此处</span>',a+="           </div>",a+='           <div class="status_bar">',a+='               <div id="status_info" class="info">选中0张文件，共0B。</div>',a+='               <div class="btns">',a+='                   <div class="webuploader_pick">继续选择</div>',a+='                   <div class="upload_btn">开始上传</div>',a+="               </div>",a+="           </div>",a+='           <div id="preview" class="upload_preview"></div>',a+="       </div>",a+='       <div class="upload_submit">',a+='           <button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>',a+="       </div>",a+='       <div id="uploadInf" class="upload_inf"></div>',a+="   </div>",a+="</form>";else{var l=parseInt(t.itemWidth.replace("px",""))-15;a+='<form id="uploadForm" action="'+t.url+'" method="post" enctype="multipart/form-data">',a+='   <div class="upload_box">',a+='       <div class="upload_main single_main">',a+='           <div class="status_bar">',a+='               <div id="status_info" class="info">选中0张文件，共0B。</div>',a+='               <div class="btns">',a+='                   <input id="fileImage" type="file" size="30" name="fileselect[]" '+e+">",a+='                   <div class="webuploader_pick">选择文件</div>',a+='                   <div class="upload_btn">开始上传</div>',a+="               </div>",a+="           </div>",a+='           <div id="preview" class="upload_preview">',a+='               <div class="add_upload">',a+='                   <a style="height:'+t.itemHeight+";width:"+t.itemWidth+';" title="点击添加文件" id="rapidAddImg" class="add_imgBox" href="javascript:void(0)">',a+='                       <div class="uploadImg" style="width:'+l+'px">',a+='                           <img class="upload_image" src="control/images/add_img.png" style="width:expression(this.width > '+l+" ? "+l+'px : this.width)" />',a+="                       </div>",a+="                   </a>",a+="               </div>",a+="           </div>",a+="       </div>",a+='       <div class="upload_submit">',a+='           <button type="button" id="fileSubmit" class="upload_submit_btn">确认上传文件</button>',a+="       </div>",a+='       <div id="uploadInf" class="upload_inf"></div>',a+="   </div>",a+="</form>"}i(d).append(a).css({width:t.width,height:t.height}),this.addEvent()},this.funSetStatusInfo=function(e){var t=0,d=e.length;i.each(e,function(i,e){t+=e.size}),t=t>1048576?(Math.round(100*t/1048576)/100).toString()+"MB":(Math.round(100*t/1024)/100).toString()+"KB",i("#status_info").html("选中"+d+"张文件，共"+t+"。")},this.funFilterEligibleFile=function(i){for(var e,t=[],d=0;e=i[d];d++)e.size>=512e5?alert('您这个"'+e.name+'"文件大小过大'):t.push(e);return t},this.funDisposePreviewHtml=function(i,e){var d="",a=parseInt(t.itemWidth.replace("px",""))-15,l="";t.del&&(l='<span class="file_del" data-index="'+i.index+'" title="删除"></span>');var s="control/images/fileType/";return s+=i.type.indexOf("rar")>0?"rar.png":i.type.indexOf("zip")>0?"zip.png":i.type.indexOf("text")>0?"txt.png":"file.png",0==i.type.indexOf("image")?(d+='<div id="uploadList_'+i.index+'" class="upload_append_list">',d+='   <div class="file_bar">',d+='       <div style="padding:5px;">',d+='           <p class="file_name">'+i.name+"</p>",d+=l,d+="       </div>",d+="   </div>",d+='   <a style="height:'+t.itemHeight+";width:"+t.itemWidth+';" href="#" class="imgBox">',d+='       <div class="uploadImg" style="width:'+a+'px">',d+='           <img id="uploadImage_'+i.index+'" class="upload_image" src="'+e.target.result+'" style="width:expression(this.width > '+a+" ? "+a+'px : this.width)" />',d+="       </div>",d+="   </a>",d+='   <p id="uploadProgress_'+i.index+'" class="file_progress"></p>',d+='   <p id="uploadFailure_'+i.index+'" class="file_failure">上传失败，请重试</p>',d+='   <p id="uploadSuccess_'+i.index+'" class="file_success"></p>',d+="</div>"):(d+='<div id="uploadList_'+i.index+'" class="upload_append_list">',d+='   <div class="file_bar">',d+='       <div style="padding:5px;">',d+='           <p class="file_name">'+i.name+"</p>",d+=l,d+="       </div>",d+="   </div>",d+='   <a style="height:'+t.itemHeight+";width:"+t.itemWidth+';" href="#" class="imgBox">',d+='       <div class="uploadImg" style="width:'+a+'px">',d+='           <img id="uploadImage_'+i.index+'" class="upload_image" src="'+s+'" style="width:expression(this.width > '+a+" ? "+a+'px : this.width)" />',d+="       </div>",d+="   </a>",d+='   <p id="uploadProgress_'+i.index+'" class="file_progress"></p>',d+='   <p id="uploadFailure_'+i.index+'" class="file_failure">上传失败，请重试</p>',d+='   <p id="uploadSuccess_'+i.index+'" class="file_success"></p>',d+="</div>"),d},this.createCorePlug=function(){var e={fileInput:i("#fileImage").get(0),uploadInput:i("#fileSubmit").get(0),dragDrop:i("#fileDragArea").get(0),url:i("#uploadForm").attr("action"),filterFile:function(i){return d.funFilterEligibleFile(i)},onSelect:function(e,a){t.onSelect(e,a),d.funSetStatusInfo(ZYFILE.funReturnNeedFiles());var l="",s=0,n=function(){if(file=e[s]){var i=new FileReader;i.onload=function(i){l+=d.funDisposePreviewHtml(file,i),s++,n()},i.readAsDataURL(file)}else o(l)},o=function(e){t.dragDrop?i("#preview").append(e):i(".add_upload").before(e),p(),u()},p=function(){i(".file_del").length>0&&i(".file_del").click(function(){return ZYFILE.funDeleteFile(parseInt(i(this).attr("data-index")),!0),!1}),i(".file_edit").length>0&&i(".file_edit").click(function(){return!1})},u=function(){i(".upload_append_list").hover(function(){i(this).find(".file_bar").addClass("file_hover")},function(){i(this).find(".file_bar").removeClass("file_hover")})};n()},onDelete:function(e,t){i("#uploadList_"+e.index).fadeOut(),d.funSetStatusInfo(t),console.info("剩下的文件"),console.info(t)},onProgress:function(e,t,d){var a=i("#uploadProgress_"+e.index),l=(t/d*100).toFixed(2)+"%";a.is(":hidden")&&a.show(),a.css("width",l)},onSuccess:function(e,a){i("#uploadProgress_"+e.index).hide(),i("#uploadSuccess_"+e.index).show(),i("#uploadInf").append("<p>上传成功，文件地址是："+a+"</p>"),t.finishDel&&(i("#uploadList_"+e.index).fadeOut(),d.funSetStatusInfo(ZYFILE.funReturnNeedFiles()))},onFailure:function(e){i("#uploadProgress_"+e.index).hide(),i("#uploadSuccess_"+e.index).show(),i("#uploadInf").append("<p>文件"+e.name+"上传失败！</p>")},onComplete:function(i){console.info(i)},onDragOver:function(){i(this).addClass("upload_drag_hover")},onDragLeave:function(){i(this).removeClass("upload_drag_hover")}};ZYFILE=i.extend(ZYFILE,e),ZYFILE.init()},this.addEvent=function(){i(".filePicker").length>0&&i(".filePicker").bind("click",function(){i("#fileImage").click()}),i(".webuploader_pick").bind("click",function(){i("#fileImage").click()}),i(".upload_btn").bind("click",function(){ZYFILE.funReturnNeedFiles().length>0?i("#fileSubmit").click():alert("请先选中文件再点击上传")}),i("#rapidAddImg").length>0&&i("#rapidAddImg").bind("click",function(){i("#fileImage").click()})},this.init()})}}(jQuery);